#!/bin/sh
#
# http://github.com/mitchweaver
#
# "du for humans"
#
# note: optionally add -L to follow links
#
# -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

usage() {
    >&2 printf 'Usage: %s [-L links] <directory>\n' "${0##*/}"
    exit 1
}

case ${1#-} in
    h|-help)
        usage
        ;;
    l|L|-links)
        LINKS=L
        shift
esac

# fix for FreeBSD as it defaults to listing all
# if a depth level greater than 1 is requested and then
# errors out if a -a flag is used
case $(uname) in
    Linux)
        NEED_A_FLAG=a
        ;;
    FreeBSD)
        ;;
esac

if [ -d "${1:-.}" ] ; then
    du "-${NEED_A_FLAG}hd$LINKS" 1 "${1:-.}" 2>/dev/null | \
        sort -rh | \
        head -n 20
elif [ -f "$1" ] ; then
    du "-${NEED_A_FLAG}h$LINKS" "$1"
fi

