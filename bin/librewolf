#!/bin/sh
#
# https://github.com/mitchweaver/bin
#
# Allow GPU acceleration using old OpenGL calls on Asahi Linux (M1 Macbooks)
# NOTE: very buggy for opengl instensive things, like browser based games
#
# Works great for YouTube / general smooth page scrolling
#
# ========================================================================
# To check if its working, open "about:support" and look for
# "Compositing: WebRender" in the Graphics section.
#
# 1. If you see "Webrender" you are GPU accelerated
# 2. If you see "Webrender (Software)"... you are not
# ========================================================================

# enable hardware acceleration in asahi
# note: this is _very_ buggy and should be removed as soon as we can
# if uname -a | grep asahi >/dev/null ; then
#     export MESA_GL_VERSION_OVERRIDE=3.3
#     export MESA_GLSL_VERSION_OVERRIDE=330
#     export MESA_GLES_VERSION_OVERRIDE=3.1
# fi

if [ "$(wayland_or_x11)" = wayland ] ; then
    export MOZ_ENABLE_WAYLAND=1
else
    export MOZ_ENABLE_WAYLAND=0
fi

export DOWNLOADS="$XDG_DOWNLOAD_DIR"

for i in /usr/bin/librewolf /usr/bin/librewolf-bin ; do
    if [ -x $i ] ; then
        export LIBREWOLF=$i
        break
    fi
done

[ "$LIBREWOLF" ] || exit 1

if [ "$1" ] ; then
    exec "$LIBREWOLF" -- "$*"
else
    exec "$LIBREWOLF"
fi

# if [ "$1" ] ; then
#     exec dbus-launch \
#         firejail \
#         --profile="${HOME}/.firejail/librewolf.profile" \
#         $LIBREWOLF -- "$*"
# else
#     exec dbus-launch \
#         firejail \
#         --profile="${HOME}/.firejail/librewolf.profile" \
#         $LIBREWOLF
# fi
