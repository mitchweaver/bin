#!/bin/sh

getbat() {
    # if plugged in
    case $(uname) in
        Linux)
            for name in AC ADP1 ; do
                [ -e /sys/class/power_supply/$name ] && break
            done
            test $(< /sys/class/power_supply/$name/online) -eq 1
            ;;
        OpenBSD)
            test $(apm -a) -eq 1
    esac
    perc="$(bperc)"
    if [ $? -eq 0 ] ; then
        # then display wired power symbol
        bat="ğŸ”Œ"
    else
        # else we are on battery, show current level
        case ${perc%?} in
            [8-9]) bat="ï‰€" ;;
            [6-7]) bat="ï‰" ;;
            [4-5]) bat="ï‰‚" ;;
            [2-3]) bat="ï‰ƒ" ;;
            *) bat="ï‰„"
        esac
    fi
    echo "$bat $perc"
}

getvpn() {
    if [ -f /tmp/vpn ] && pgrep openvpn >/dev/null ; then
        echo "ï€£ $(cat /tmp/vpn)"
    else
        echo "ï‚œ None"
    fi
}

getvol() { 
    vol="$(vol)"
    case ${vol%??} in
        10|[5-9]) echo "ğŸ”Š $vol" ;;
        [1-4])    echo "ğŸ”‰ $vol" ;;
        *)        echo "ğŸ”ˆ $vol"
    esac
}

getssid() {
    ssid="$(ssid)"
    if [ "$ssid" ] ; then
        echo "ï‡« $ssid"
    else
        echo "ï‘§ No Internet"
    fi
}

getsong() {
    if pgrep -x mpv >/dev/null ; then
        echo "[ ğŸµ $(song) ]"
    fi
}

while true ; do
buf=" \
$(getsong)\
[ğŸŒ¡ï¸ $(temp) ]\
[ $(getvpn) ]\
[ $(getssid) ]\
[ â˜€ $(bright) ]\
[ $(getbat)% ]\
[ $(getvol)% ]\
[ $(date '+%a %b %d - %I:%M %p') ]"
    xsetroot -name "$buf"
    sleep 5
done
# [ ğŸ’» $(cpu) ]\
